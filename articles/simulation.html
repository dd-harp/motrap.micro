<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="motrap.micro">
<title>Simulation • motrap.micro</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation">
<meta property="og:description" content="motrap.micro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">motrap.micro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/point_sets.html">Making Point Sets</a>
    <a class="dropdown-item" href="../articles/visualizing_dispersal.html">Visualizing Micro-Dispersal</a>
    <a class="dropdown-item" href="../articles/basic_dispersal.html">On Dispersal Matrices</a>
    <a class="dropdown-item" href="../articles/simulation.html">Simulation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/motrap.micro/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulation</h1>
            
      
      
      <div class="d-none name"><code>simulation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>If we want to target vector interventions for malaria spatially,
fine-grained spatial simulations can be useful. Fine-grained models can
be difficult to formulate and implement, but they make it possible to
conduct thought experiments to test ideas about mosquito populations,
such as the robustness of metrics we use to measure mosquito
populations, spatial targeting, and spatial aspects of vector control
coverage and effect sizes.</p>
<p>This software was designed to implement <em>micro-simulation</em>
models where mosquitoes move among <em>point sets.</em> To model
mosquito movement, we are interested in mosquito searching behavior for
resources. Searching for a resource – a blood host, or a habitat – is
linked to a <em>behavioral state</em> and the end of searching is at a
point in space where the resources exist. The software implements a set
of models that combine these two ideas that represent important
departures from the standard theoretical approach to malaria <a href="https://dd-harp.github.io/motrap.micro/index.html">(landing
page)</a>. In the following, we walk through the standard model
setup.</p>
<hr>
<div class="figure">
<img src="DynamicsOnPoints.png" alt=""><p class="caption"><strong>Figure 1:</strong> In microsimulation models,
mosquitoes move among point sets. Blood feeding on hosts occurs at a
fixed set of locations. The figure, modified from Perkins TA, <em>et
al.</em> (2013)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Perkins TA, Scott TW, Le Menach A, Smith DL (2013).
Heterogeneity, mixing, and the spatial scales of mosquito-borne pathogen
transmission. PLoS Comput Biol 9:e1003327, &lt;a href="https://doi.org/10.1371/journal.pcbi.1003540" class="external-link uri"&gt;https://doi.org/10.1371/journal.pcbi.1003540&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>, illustrates some of the key elements: a
set of points where mosquitoes feed, <em>{f},</em> and habitats where
they lay eggs <em>{l)</em>. Dispersal among those point sets is
determined by two matrices, one that describes dispersal to blood feed,
<span class="math inline">\(F\)</span>, and another to lay eggs, <span class="math inline">\(L\)</span>. The framework also describes exposure
to infection by a human population.</p>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="demo">Demo<a class="anchor" aria-label="anchor" href="#demo"></a>
</h2>
<div class="section level3">
<h3 id="resource-landscape">Resource Landscape<a class="anchor" aria-label="anchor" href="#resource-landscape"></a>
</h3>
<p>To get started, we need to set up a <strong>microsimulation
landscape,</strong> which includes point sets and matrices describing
dispersal among those point sets:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">24328</span><span class="op">)</span></span>
<span><span class="va">bb</span> <span class="op">=</span> <span class="fu"><a href="../reference/unif_xy.html">unif_xy</a></span><span class="op">(</span><span class="fl">256</span>, <span class="op">-</span><span class="fl">17</span>, <span class="fl">17</span><span class="op">)</span> </span>
<span><span class="va">qq</span> <span class="op">=</span> <span class="fu"><a href="../reference/unif_xy.html">unif_xy</a></span><span class="op">(</span><span class="fl">289</span>, <span class="op">-</span><span class="fl">17</span>, <span class="fl">17</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_points_bq.html">plot_points_bq</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">qq</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="dispersal">Dispersal<a class="anchor" aria-label="anchor" href="#dispersal"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kFb</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_kF_exp.html">make_kF_exp</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">2</span>, s<span class="op">=</span><span class="fl">1</span>, gamma<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">kFq</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_kF_exp.html">make_kF_exp</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">2</span>, s<span class="op">=</span><span class="fl">2</span>, gamma<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu">kFb</span><span class="op">(</span><span class="va">dd</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"darkred"</span>, xlab <span class="op">=</span> <span class="st">"Distance"</span>, ylab <span class="op">=</span> <span class="st">"Weight"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu">kFq</span><span class="op">(</span><span class="va">dd</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Psi_bb</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_Psi_xx.html">make_Psi_xx</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">kFb</span><span class="op">)</span></span>
<span><span class="va">Psi_qb</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_Psi_xy.html">make_Psi_xy</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">qq</span>, <span class="va">kFq</span><span class="op">)</span></span>
<span><span class="va">Psi_bq</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_Psi_xy.html">make_Psi_xy</a></span><span class="op">(</span><span class="va">qq</span>, <span class="va">bb</span>, <span class="va">kFb</span><span class="op">)</span></span>
<span><span class="va">Psi_qq</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_Psi_xx.html">make_Psi_xx</a></span><span class="op">(</span><span class="va">qq</span>, <span class="va">kFq</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_Psi_BQ.html">plot_Psi_BQ</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">qq</span>, <span class="va">Psi_bb</span>, <span class="va">Psi_qb</span>, <span class="va">Psi_bq</span>, <span class="va">Psi_qq</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="setting-up-a-model">Setting up a model<a class="anchor" aria-label="anchor" href="#setting-up-a-model"></a>
</h3>
<p>To simulate mosquito population dynamics, we need to set up an object
that stores all the information. In R, we set up the model as a list. To
simulate, each model must fully define a set of parameters and initial
values. To streamline the process, we developed a function called
<code>setup_model</code> that accepts some basic arguments and that
returns a fully defined model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opts_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kFb <span class="op">=</span> <span class="va">kFb</span>, kFq <span class="op">=</span> <span class="va">kFq</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/setup_model.html">setup_model</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">qq</span>, dispersal_opts<span class="op">=</span><span class="va">opts_d</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "b"     "q"     "nb"    "nq"    "Mpar"  "Mvars" "terms" "Lpar"  "Lvars"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Mpar</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "setup"  "Psi_bb" "Psi_qb" "Psi_bq" "Psi_qq" "psiQ"   "ova"    "Mbb"   </span></span>
<span><span class="co">##  [9] "Mqb"    "Mbq"    "Mqq"    "Mbl"    "bigM"   "eip"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Lpar</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "pL"    "zeta"  "theta" "xi"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="solving">Solving<a class="anchor" aria-label="anchor" href="#solving"></a>
</h3>
<p>We can solve the model and produce output by calling the function
<code>SIM</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SIM.html">SIM</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>The population densities are highly heterogeneous, even though the
habitats and blood feeding sites that are all alike in every way except
location. Here, the size of each point scales with the density of the
adult, female mosquito population at that point (red = blood feeding,
blue = egg laying).</p>
<p><img src="simulation_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David L. Smith, Héctor M. Sánchez C.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
